<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet/less" type="text/css" href="http://jonnyreeves.co.uk/theme/css/style.less">
  <script src="http://jonnyreeves.co.uk/theme/js/less-1.5.0.min.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/style.css"> -->

  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Jonny Reeves">
  <meta name="description" content="Posts and writings by Jonny Reeves">

  <link href="http://jonnyreeves.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jonny Reeves Full Atom Feed" />

<meta name="keywords" content="">

  <title>
Builder Pattern in ActionScript – Fluent Constructors  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://jonnyreeves.co.uk">
        <img src="/images/avatar.jpg" alt="logo">
      </a>
      <h2><a href="http://jonnyreeves.co.uk">Jonny Reeves</a></h2>
      <p></p>
      <ul>
        <li><a href="http://github.com/jonnyreeves" target="_blank">Github</a></li>
        <li><a href="http://stackoverflow.com/users/227349/jonnyreeves" target="_blank">Stack Overflow</a></li>
        <li><a href="https://plus.google.com/+JohnReeves" target="_blank">+JonnyReeves</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
<p>Posted on Fri 25 March 2011</p>
    </header>

<article>
  <div class="article_title">
    <h3><a href="http://jonnyreeves.co.uk/2011/builder-pattern-in-actionscript-fluent-constructors/">Builder Pattern in ActionScript – Fluent Constructors</a></h3>
  </div>
  <div class="article_text">
    <p>How many times have you come across a class which looks like this:</p>
<div class="highlight"><pre><span class="kd">package</span> <span class="nx">nutrition</span><span class="p">.</span><span class="nx">model</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">NutritionFacts</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>    <span class="c1">// (mL) required</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// (per container) required</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_calories</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_fat</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>        <span class="c1">// (g) optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_salt</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// (mg) optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_carbohydrate</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>   <span class="c1">// (g)  optional</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">NutritionFacts</span><span class="p">(</span><span class="nx">servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">,</span> <span class="nx">servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">,</span> <span class="nx">calories</span> <span class="o">:</span> <span class="nb">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">fat</span> <span class="o">:</span> <span class="nb">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">salt</span> <span class="o">:</span> <span class="nb">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">carbohydrate</span> <span class="o">:</span> <span class="nb">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">{</span>
            <span class="nx">_servingSize</span> <span class="o">=</span> <span class="nx">servingSize</span><span class="o">;</span>
            <span class="nx">_servings</span> <span class="o">=</span> <span class="nx">servings</span><span class="o">;</span>
            <span class="nx">_calories</span> <span class="o">=</span> <span class="nx">calories</span><span class="o">;</span>
            <span class="nx">_fat</span> <span class="o">=</span> <span class="nx">fat</span><span class="o">;</span>
            <span class="nx">_salt</span> <span class="o">=</span> <span class="nx">salt</span><span class="o">;</span>
            <span class="nx">_carbohydrate</span> <span class="o">=</span> <span class="nx">carbohydrate</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>I’m not a great fan of this style of object construction, it ends up making massive single lines of code which are confusing to read for example, in the following example, what does the 4th argument actually set, why is it zero?</p>
<div class="highlight"><pre><span class="kd">const</span> <span class="nx">colaFacts</span> <span class="o">:</span> <span class="nx">NutritionFacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NutritionFacts</span><span class="p">(</span><span class="mi">330</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">500</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">35</span><span class="o">,</span> <span class="mi">22</span><span class="p">)</span>
</pre></div>


<p>One soltution to this problem is to only demand the required fields in the constructor and use setters for the other fields, we end up with something similar to this:</p>
<div class="highlight"><pre><span class="kd">package</span> <span class="nx">nutrition</span><span class="p">.</span><span class="nx">model</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">NutritionFacts</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>    <span class="c1">// (mL) required</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// (per container) required</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_calories</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_fat</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>            <span class="c1">// (g) optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_salt</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>           <span class="c1">// (mg) optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_carbohydrate</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>   <span class="c1">// (g)  optional</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">SetterNutritionFacts</span><span class="p">(</span><span class="nx">servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">,</span> <span class="nx">servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_servingSize</span> <span class="o">=</span> <span class="nx">servingSize</span><span class="o">;</span>
            <span class="nx">_servings</span> <span class="o">=</span> <span class="nx">servings</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="nx">calories</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
            <span class="nx">_calories</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="nx">fat</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
            <span class="nx">_fat</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="nx">salt</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
            <span class="nx">_salt</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="nx">carbohydrate</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
            <span class="nx">_carbohydrate</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>To create our ColaFacts object using the above we would code:</p>
<div class="highlight"><pre><span class="kd">const</span> <span class="nx">colaFacts</span> <span class="o">:</span> <span class="nx">NutritionFacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NutritionFacts</span><span class="p">(</span><span class="mi">330</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">colaFacts</span><span class="p">.</span><span class="nx">calories</span> <span class="o">=</span> <span class="mi">500</span><span class="o">;</span>
<span class="nx">colaFacts</span><span class="p">.</span><span class="nx">salt</span> <span class="o">=</span> <span class="mi">35</span><span class="o">;</span>
<span class="nx">colaFacts</span><span class="p">.</span><span class="nx">carbohydrate</span> <span class="o">=</span> <span class="mi">22</span><span class="o">;</span>
</pre></div>


<p>In my opinion this approach is preferable, but now it has introduced a different problem, one of design. In the first example where all the arguments were passed in the constructor, the NutritionFacts object was immutable – its values could not be modified once the object had been instantiated. However, with the NutritionFacts object shown above the calories, fat, salt and carbohydrate values can all be modified elsewhere in the code. If we have our purist Object Orientated Developer hat on we would declare this as a violation of encapsulation.</p>
<p>The Builder Pattern offers us a solution, it allows us to create an immutable object (ie: no setters) which doesn’t end up having a massive constructor for all the optional values it can contain. In Effective Java, 2nd Edition, Joshua Bloch covers this under the title of “<a href="http://books.google.co.uk/books?id=ka2VUBqHiWkC&amp;pg=PA11&amp;lpg=PA11&amp;dq=Consider+a+Builder+when+faced+with+many+constructor+parameters&amp;source=bl&amp;ots=yZChKfnZM2&amp;sig=8_wa7cmd_8-OcpGHRPmgezV79xw&amp;hl=en&amp;sa=X&amp;ei=1waUU7LXIMO_PNXGgLgI&amp;ved=0CDwQ6AEwAQ#v=onepage&amp;q=Consider%20a%20Builder%20when%20faced%20with%20many%20constructor%20parameters&amp;f=false">Consider a Builder when faced with many constructor parameters</a>”. In his book, Josh makes use of an inner class to create the Builder, although we have inner classes in ActionScript, they do not share the same behaviour as those in Java, especially when it comes to the visibility of member properties – this makes implementing Josh’s example in ActionScript difficult, however, by using the internal visibility modifier we can create a close approximation.</p>
<p>First we have the NutritionFactsBuilder, this is based upon the Builder pattern and make use of a fluent interface:</p>
<div class="highlight"><pre><span class="kd">package</span> <span class="nx">nutrition</span><span class="p">.</span><span class="nx">model</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">NutritionFactsBuilder</span> <span class="p">{</span>
        <span class="kd">internal</span> <span class="k">var</span> <span class="nx">servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>
        <span class="kd">internal</span> <span class="k">var</span> <span class="nx">servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>
        <span class="kd">internal</span> <span class="k">var</span> <span class="nx">calories</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>
        <span class="kd">internal</span> <span class="k">var</span> <span class="nx">fat</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>
        <span class="kd">internal</span> <span class="k">var</span> <span class="nx">salt</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>
        <span class="kd">internal</span> <span class="k">var</span> <span class="nx">carbohydrate</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>   

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">NutritionFactsBuilder</span><span class="p">(</span><span class="nx">servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">,</span> <span class="nx">servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">servingSize</span> <span class="o">=</span> <span class="nx">servingSize</span><span class="o">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">servings</span> <span class="o">=</span> <span class="nx">servings</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">withCalories</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">NutritionFactsBuilder</span> <span class="p">{</span>
            <span class="nx">calories</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">withFat</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">NutritionFactsBuilder</span> <span class="p">{</span>
            <span class="nx">fat</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">withSalt</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">NutritionFactsBuilder</span> <span class="p">{</span>
            <span class="nx">salt</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">withCarbohydrate</span><span class="p">(</span><span class="nx">value</span> <span class="o">:</span> <span class="nb">uint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">NutritionFactsBuilder</span> <span class="p">{</span>
            <span class="nx">carbohydrate</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span> <span class="o">:</span> <span class="nx">NutritionFacts</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">NutritionFacts</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Next up we have the NutritionFacts class, note that now the only argument it expects in the constructor is a NutritionFactsBuilder instance:</p>
<div class="highlight"><pre><span class="kd">package</span> <span class="nx">nutrition</span><span class="p">.</span><span class="nx">model</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">NutritionFacts</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_servingSize</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>    <span class="c1">// (mL) required</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_servings</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// (per container) required</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_calories</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_fat</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>        <span class="c1">// (g) optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_salt</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>       <span class="c1">// (mg) optional</span>
        <span class="kd">private</span> <span class="k">var</span> <span class="nx">_carbohydrate</span> <span class="o">:</span> <span class="nb">uint</span><span class="o">;</span>   <span class="c1">// (g)  optional</span>

        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">NutritionFacts</span><span class="p">(</span><span class="nx">builder</span> <span class="o">:</span> <span class="nx">NutritionFactsBuilder</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_servingSize</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">servingSize</span><span class="o">;</span>
            <span class="nx">_servings</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">servings</span><span class="o">;</span>
            <span class="nx">_calories</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">calories</span><span class="o">;</span>
            <span class="nx">_fat</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">fat</span><span class="o">;</span>
            <span class="nx">_salt</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">salt</span><span class="o">;</span>
            <span class="nx">_carbohydrate</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">carbohydrate</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>We can now employ the builder to create us our NutritionFacts object:</p>
<div class="highlight"><pre><span class="kd">const</span> <span class="nx">colaFacts</span> <span class="o">:</span> <span class="nx">NutritionFacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NutritionFactsBuilder</span><span class="p">(</span><span class="mi">330</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCalories</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withSalt</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCarbohydrate</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
</pre></div>


<p>Note that we are supplying the required servingSize and servings values in the NutritionFactsBuilder() constructor, but all the other optional values can now be supplied via method chaining. When build() is called the NutritionFactsBuilder will return a new instance of NutrionFacts for us; this constructed NutritionFacts object is now immutable and the reader can easily see which properties are going to be set on the instance. Because we have made the properties of the NutritionFactBuilder object internal, they are only visible to classes inside the “nutrition.model” package, as the consumers of models shouldn’t be in the models package they will not be visible (only the public with… methods will be). Another nice benefit is that we have split construction of our object (performed by the NutritionFactsBuilder) out from the actual object (NutrtionFacts) – if NutritionFacts was instead an interface, the Builder could return a different concrete instance to the user without them ever knowing.</p>
<p>By using the Builder Pattern in this fashion we are creating something similar to named parameters as found in other languages – other ActionScript developers have already found their own solutions to this, the most recognisable being Greensock’s excellent TweenLite, where an untyped object is used to optional provide parameters ie:</p>
<div class="highlight"><pre><span class="k">new</span> <span class="nx">TweenLite</span><span class="p">(</span><span class="nx">target</span><span class="o">,</span> <span class="mf">0.8</span><span class="o">,</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">50</span><span class="o">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">});</span>
</pre></div>


<p>I think this works well for TweenLite, however, I often find myself having to head on over to greensock.com whenever I need to do something a little bit more complicated (for example, is it onCompleteParams, or onCompleteArgs?), the above Builder Pattern approach could have possibly answered that for us:</p>
<div class="highlight"><pre><span class="k">new</span> <span class="nx">TweenBuilder</span><span class="p">(</span><span class="nx">target</span><span class="o">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">y</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">onCompleteParams</span><span class="p">([</span> <span class="s2">&quot;foo&quot;</span> <span class="p">])</span>
    <span class="p">.</span><span class="nx">tween</span><span class="p">();</span>
</pre></div>
  </div>
  <div class="article_meta">
    <p>Category: <a href="http://jonnyreeves.co.uk/category/actionscript.html">ActionScript</a></p>
  </div>


</article>

    <footer>
<p><a href="http://jonnyreeves.co.uk/" class="button_accent">&larr; Back to Index</a></p>
<script language="javascript">
    function toggleComments() {
        var commentDiv = document.getElementById("article_comments");
        (commentDiv.style.display == "none") ? commentDiv.style.display = "block" : commentDiv.style.display = "none";
        return false;
    }
</script>
    </footer>

    <div id="ending_message">
      <p>&copy; Jonny Reeves. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/giulivo/pelican-svbhack" target="_blank">github</a>. .</p>
    </div>
  </main>
</body>
</html>
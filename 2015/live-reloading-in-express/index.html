<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/font-awesome.min.css">
  <link href="http://jonnyreeves.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jonny Reeves Atom">
  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
<meta name="author" content="Jonny Reeves" />
<meta name="description" content="Gaffa tape time. Getting iteration times down is important when building software, if nothing else it makes it more fun and help you keep the flow going. With this in mind, let's get live reloading working with Mustache templates on an express-based local development server. Let's start simple by …" />
<meta name="keywords" content="">
<meta property="og:site_name" content="Jonny Reeves"/>
<meta property="og:title" content="Live Reloading in Express"/>
<meta property="og:description" content="Gaffa tape time. Getting iteration times down is important when building software, if nothing else it makes it more fun and help you keep the flow going. With this in mind, let's get live reloading working with Mustache templates on an express-based local development server. Let's start simple by …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://jonnyreeves.co.uk/2015/live-reloading-in-express/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2015-10-31 21:00:00+00:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://jonnyreeves.co.uk/author/jonny-reeves.html">
<meta property="article:section" content="JavaScript"/>
<meta property="og:image" content="/images/avatar.jpg">  <title>Jonny Reeves &ndash; Live Reloading in Express</title>
</head>
<body>
  <aside>
    <div>
      <a href="/">
        <img src="/images/avatar.jpg" alt="Jonny Reeves" title="Jonny Reeves">
      </a>
      <h1><a href="/">Jonny Reeves</a></h1>
      <p>code && coffee || music</p>
      <nav>
        <ul class="list">
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-linkedin" href="https://br.linkedin.com/in/jonnyreeves/en" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/+JohnReeves" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-stack-overflow" href="http://stackoverflow.com/users/227349/jonnyreeves" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
        <li><a class="sc-github" href="https://github.com/jonnyreeves" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h1 id="live-reloading-in-express">Live Reloading in Express</h1>
    <p>Posted on Sat 31 October 2015 in <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a></p>
  </header>
  <div>
    <p>Gaffa tape time.  Getting iteration times down is important when building software, if nothing else it makes it more fun and help you keep the flow going.  With this in mind, let's get live reloading working with <a href="https://github.com/janl/mustache.js/">Mustache templates</a> on an <a href="https://www.npmjs.com/package/express">express</a>-based local development server.</p>
<p>Let's start simple by serving some templates:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">express</span> <span class="nx">from</span> <span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">mustache</span> <span class="nx">from</span> <span class="s1">&#39;mustache&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">fs</span> <span class="nx">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>

<span class="c1">// Create a new express server instance.</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// Handle GET requests to `/hello`.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Read the template and JSON data from the local filesystem.</span>
  <span class="kr">const</span> <span class="nx">tpl</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;./hello.mustache&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;./hello.json&#39;</span><span class="p">));</span>

  <span class="c1">// Serve back the rendered template.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">mustache</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="nx">data</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`server started at http://localhost:3000`</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</pre></div>


<p>So far so good, but let's make it live-reload so we can do this:</p>
<p><a href="https://gyazo.com/326ca72b98bce37af177d9e8d5143279"><img alt="https://gyazo.com/326ca72b98bce37af177d9e8d5143279" src="https://i.gyazo.com/326ca72b98bce37af177d9e8d5143279.gif"></a></p>
<p>First stop is to grab the <a href="https://www.npmjs.com/package/livereload">livereload module</a> from NPM; this creates its own server which serves a javascript file used for relaying changes back to the browser; it also sets up a file-system monitor to detect changes when you modify your source files.</p>
<div class="highlight"><pre><span></span><span class="c1">// Create a livereload server</span>
<span class="kr">const</span> <span class="nx">reloadServer</span> <span class="o">=</span> <span class="nx">livereload</span><span class="p">.</span><span class="nx">createServer</span><span class="p">({</span>
  <span class="c1">// Reload on changes to these file extensions.</span>
  <span class="nx">exts</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;mustache&#39;</span> <span class="p">],</span>
  <span class="c1">// Print debug info</span>
  <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="c1">// Specify the folder to watch for file-changes.</span>
<span class="nx">reloadServer</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">);</span>
</pre></div>


<p>The last piece is to inject the <code>livereload.js</code> into your HTML; the <a href="https://github.com/intesso/connect-livereload">connect-livereload module</a> takes care of this; just drop it into your app before your define your routes:</p>
<div class="highlight"><pre><span></span><span class="c1">// Inject the livereload.js script tag into pages.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">livereloadMiddleware</span><span class="p">());</span>
</pre></div>


<p>Et viola, live reloading of mustache templates and their associated data.  Full source over on <a href="https://github.com/jonnyreeves/mustache-express-hotreload">github</a>.</p>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jonnyreeves';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
      <p>&copy; Jonny Reeves </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30309890-1', 'auto');
  ga('send', 'pageview');
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Live Reloading in Express",
  "headline": "Live Reloading in Express",
  "datePublished": "2015-10-31 21:00:00+00:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Jonny Reeves",
    "url": "http://jonnyreeves.co.uk/author/jonny-reeves.html"
  },
  "image": "/images/avatar.jpg",
  "url": "http://jonnyreeves.co.uk/2015/live-reloading-in-express/",
  "description": "Gaffa tape time. Getting iteration times down is important when building software, if nothing else it makes it more fun and help you keep the flow going. With this in mind, let's get live reloading working with Mustache templates on an express-based local development server. Let's start simple by …"
}
</script></body>
</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet/less" type="text/css" href="http://jonnyreeves.co.uk/theme/css/style.less">
  <script src="http://jonnyreeves.co.uk/theme/js/less-1.5.0.min.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/style.css"> -->

  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Jonny Reeves">
  <meta name="description" content="Posts and writings by Jonny Reeves">

  <link href="http://jonnyreeves.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jonny Reeves Full Atom Feed" />

<meta name="keywords" content="">

  <title>
Modular Javascript Unit Testing with QUnit and RequireJS  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://jonnyreeves.co.uk">
        <img src="/images/avatar.jpg" alt="logo">
      </a>
      <h2><a href="http://jonnyreeves.co.uk">Jonny Reeves</a></h2>
      <p></p>
      <ul>
        <li><a href="http://github.com/jonnyreeves" target="_blank">Github</a></li>
        <li><a href="http://stackoverflow.com/users/227349/jonnyreeves" target="_blank">Stack Overflow</a></li>
        <li><a href="https://plus.google.com/+JohnReeves" target="_blank">+JonnyReeves</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
<p>Posted on Tue 14 August 2012</p>
    </header>

<article>
  <div class="article_title">
    <h2><a href="http://jonnyreeves.co.uk/2012/modular-javascript-unit-testing-with-qunit-and-requirejs/">Modular Javascript Unit Testing with QUnit and RequireJS</a></h2>
  </div>
  <div class="article_text">
    <p>Modular application development is essential when working on a large project with more than a handful of developers. Breaking your code into separate modules improves code legibility and organization making it easier to locate logic and help create ‘seams’ in your code so you can do your best to adhere to <a href="http://www.codinghorror.com/blog/2007/03/curlys-law-do-one-thing.html">Single Responsibility Principle</a>. This is all well and good for your application code, but what about the Unit Tests which support it – how can we decompose these tests into modules so they’re well organized and easy to find?</p>
<h3>Test Case Structure</h3>
<p>First things first, you need to get your Unit Tests broken up into separate test cases. QUnit provides the QUnit.module method which takes care of this, allowing your to group tests in the QUnit test runner. We can extend this metaphor further by ensuring that each QUnit module resides in its own file, or, in other words – each application module has it’s own QUnit module of tests.</p>
<p>Here’s an example of a simple QUnit Test Case defined as a RequireJS module:</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Import depdendencies (note you can use relative paths here)</span>
    <span class="kd">var</span> <span class="nx">PegiRatings</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./PegiRatings&quot;</span><span class="p">);</span>

    <span class="c1">// Define the QUnit module and lifecycle.</span>
    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;example/model/PegiRatings&quot;</span><span class="p">);</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;isSuitibleFor - younger age supplied, returns false&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">PegiRatings</span><span class="p">.</span><span class="nx">PEGI_18</span><span class="p">.</span><span class="nx">isSuitibleFor</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;isSuitibleFor - same age supplied, returns true&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">PegiRatings</span><span class="p">.</span><span class="nx">PEGI_18</span><span class="p">.</span><span class="nx">isSuitibleFor</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;isSuitibleFor - older age supplied, returns true&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">PegiRatings</span><span class="p">.</span><span class="nx">PEGI_18</span><span class="p">.</span><span class="nx">isSuitibleFor</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>As you can see above, we are able to use <code>require</code> to import other modules from the src folder into the test case (in the above example we are including the PegiRatings object, which just happens to be the module under test). Here’s another example where we pull in not only other modules from the source tree, but also a vendor library (the ever popular, underscore.js):</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Import depdendencies.</span>
    <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;vendor/underscore&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Player</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./Player&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Game</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./Game&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">PegiRatings</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./PegiRatings&quot;</span><span class="p">);</span>

    <span class="c1">// ... rest of test case omitted for brevity</span>

<span class="p">});</span>
</pre></div>


<h3>Configuring QUnit and RequireJS</h3>
<p>Now that we have our unit tests split out into separate modules, we need to configure the QUnit Test Runner so that it will work with RequireJS to resolve the dependencies. The first step is to modify the stock QUnit Test Runner HTML document so RequireJS is loaded along with all our testcases.</p>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Example Test Runner<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;vendor/qunit.css&quot;</span> <span class="nt">/&gt;</span>

        <span class="c">&lt;!-- QUnit includes --&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;vendor/qunit.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

        <span class="c">&lt;!-- Load RequireJS &amp; the testsuite --&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../src/require-config.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../src/vendor/require.js&quot;</span> <span class="na">data-main=</span><span class="s">&quot;testsuite.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;qunit&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>In a typical QUnit Test Runner setup you would include your <code>tests.js</code> file which included all your QUnit tests. Instead we load the project’s <a href="http://requirejs.org/docs/api.html#config">RequireJS configuration file</a> (which is also used by the main project, to avoid duplication of configuration settings between the tests and the build) and then RequireJS itself with a callback to the <code>testsuite.js</code> file.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Defer Qunit so RequireJS can work its magic and resolve all modules.</span>
    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">autostart</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// Configure RequireJS so it resolves relative module paths from the `src`</span>
    <span class="c1">// folder.</span>
    <span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
        <span class="nx">baseUrl</span><span class="o">:</span> <span class="s2">&quot;../src&quot;</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="c1">// A list of all QUnit test Modules.  Make sure you include the `.js` </span>
    <span class="c1">// extension so RequireJS resolves them as relative paths rather than using</span>
    <span class="c1">// the `baseUrl` value supplied above.</span>
    <span class="kd">var</span> <span class="nx">testModules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;example/model/PlayerTests.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;example/model/PegiRatingsTests.js&quot;</span>
    <span class="p">];</span>

    <span class="c1">// Resolve all testModules and then start the Test Runner.</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">testModules</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
<span class="p">}());</span>
</pre></div>


<p>This file configures RequireJS ready for our Unit Test run and also provides a list of all test cases that we wish to execute. Once RequireJS has finished loading all the test cases, it makes a call to <code>QUnit.start</code> which kicks off the Test Runner.</p>
<h3>Example Project Download</h3>
<p>I’ve pushed all the source for this example project to the <a href="https://github.com/jonnyreeves/qunit-require/">qunit-require GitHub Repo</a>. You can <a href="https://github.com/jonnyreeves/qunit-require/zipball/master">download the zipball</a> and run the tests to gain a better understanding of the project structure.</p>
  </div>
  <div class="article_meta">
    <p>Category: <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a></p>
  </div>


</article>

    <footer>
<p><a href="http://jonnyreeves.co.uk/" class="button_accent">&larr; Back to Index</a></p>
<script language="javascript">
    function toggleComments() {
        var commentDiv = document.getElementById("article_comments");
        (commentDiv.style.display == "none") ? commentDiv.style.display = "block" : commentDiv.style.display = "none";
        return false;
    }
</script>
    </footer>

    <div id="ending_message">
      <p>&copy; Jonny Reeves. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/giulivo/pelican-svbhack" target="_blank">github</a>. .</p>
    </div>
  </main>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://jonnyreeves.co.uk/theme/css/font-awesome.min.css">
  <link href="http://jonnyreeves.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jonny Reeves Atom">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
  <meta name="author" content="Jonny Reeves" />
  <meta name="description" content="" />
<meta property="og:site_name" content="Jonny Reeves"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Jonny Reeves"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://jonnyreeves.co.uk"/>
<meta property="og:image" content="/images/avatar.jpg">
  <title>Jonny Reeves</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://jonnyreeves.co.uk">
        <img src="/images/avatar.jpg" alt="Jonny Reeves" title="Jonny Reeves">
      </a>
      <h1><a href="http://jonnyreeves.co.uk">Jonny Reeves</a></h1>
      <p>code && coffee || music</p>
      <nav>
        <ul class="list">
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-linkedin" href="https://br.linkedin.com/in/jonnyreeves/en" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/+JohnReeves" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-stack-overflow" href="http://stackoverflow.com/users/227349/jonnyreeves" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
        <li><a class="sc-github" href="https://github.com/jonnyreeves" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2015/injecting-into-methods-with-typescript-decorators/#injecting-into-methods-with-typescript-decorators">Injecting into Methods with TypeScript Decorators</a></h2>
    <p>
      Posted on Mon 03 August 2015 in <a href="http://jonnyreeves.co.uk/category/typescript.html">TypeScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2015/injecting-into-methods-with-typescript-decorators/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>Expanding upon my <a href="http://localhost:8000/2015/basic-typescript-dependency-injection-with-decorators/">last post on Property based Dependency Injection</a>, let's have a look at what we need to do in order to inject into methods - here's what we want to achieve:</p>
<div class="highlight"><pre>class Person {
  private _firstName : string;
  private _lastName : string;

  @inject(&#39;firstName&#39;, &#39;lastName&#39;)
  setName(first : string, last : string) {
    this._firstName = first;
    this._last = last;
  }

  getFullName() : string {
    return `<span class="cp">${</span><span class="n">firstName</span><span class="cp">}</span> <span class="cp">${</span><span class="n">lastName</span><span class="cp">}</span>`
  }
}
</pre></div>


<p>Here we are decorating the <code>Person#setName()</code> method with the <code>@inject</code> decorator and requesting the values mapped against the 'firstName' and 'lastName' injection keys from the Dependency Container - our test case would look something like this:</p>
<div class="highlight"><pre>// Setup the container
injector.map(&#39;firstName&#39;, &#39;Jonny&#39;);
injector.map(&#39;lastName&#39;, &#39;Reeves&#39;);

// Instantiate a Person, the container will apply the injections.
const jonny = injector.instantiate(Person);

// Test it worked.
if (jonny.getFullName() !== &#39;Jonny Reeves&#39;) {
    throw new Error(&#39;expected jonny.getFullName() to be Jonny Reeves but was &#39; + jonny.getFullName());
}
</pre></div>


<p>First of all we need to modify our <code>@inject</code> decorator, originally it only expected a single argument (the <code>injectionKey</code>), as methods can take more than one argument we need to make use of <a href="">rest parameters</a> to accept any number of strings:</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">inject</span><span class="p">(...</span><span class="nx">injectionKeys</span> <span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>


<p>We face a slightly tricker challenge in the fact that injecting values into methods requires us to inoke a method rather than just assinging a property on the target object, in the previous implementation the <code>__inject__</code> Object was a simple hash of property name to injectionKey, but in order to inovoke the target method with the injection values in the correct scope we will need access to the target object as well.  To group this data together I've created an <code>InjectionPoint</code> object and assign this as the new value in the <code>__inject__</code> map:</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">inject</span><span class="p">(...</span><span class="nx">injectionKeys</span> <span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> 
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">recordInjection</span><span class="p">(</span><span class="nx">target</span> <span class="o">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">decoratedPropertyName</span> <span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>

    <span class="nx">targetType</span><span class="p">.</span><span class="nx">__inject__</span><span class="cp">[</span><span class="nx">decoratedPropertyName</span><span class="cp">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionPoint</span><span class="p">(</span>
                                        <span class="nx">target</span><span class="p">,</span> <span class="nx">decoratedPropertyName</span><span class="p">,</span> <span class="nx">injectionKeys</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Now we're storing the <code>InjectionPoint</code> data we need to modify <code>Injector#instantiate()</code> to make use of it when invoked.  The first change is driven by the fact the target Class' <code>__inject__</code> property is a hash of propertyNames to <code>InjectionPoint</code>'s and that an <code>InjectionPoint</code> provides one or more injectionKeys (before it was a hash of propertyNames to a single injectionKey), <code>Injector#getInjectionValues()</code> makes light work of this returning a collection of values to be injected:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="n">Injector</span> {
  /* ... */

  <span class="n">private</span> <span class="n">getInjectionValues</span>(<span class="n">injectionPoint</span> : <span class="n">InjectionPoint</span>) : <span class="nb">Array</span><span class="s">&lt;any&gt;</span> {
    <span class="k">return</span> <span class="n">injectionPoint</span>.<span class="n">injectionKeys</span>
      .<span class="nb">map</span>(<span class="nb">key</span> =&gt; <span class="n">this</span>.<span class="n">valuesByInjectionKey</span>[<span class="nb">key</span>]);
  }
}
</pre></div>


<p>Now we need to determine how these values should be injected (either via a property of the target object, or by invoking a method of the target object).  Seeing as the <code>InjectionPoint</code> has all the knowledge it needs to perform the correct injection I employed the <a href="http://c2.com/cgi/wiki?HollywoodPrinciple">Hollywood Principle</a> and added an <code>InjectionPoint#inject()</code> method which the <code>Injector</code> invokes:</p>
<div class="highlight"><pre><span class="kr">class</span> <span class="nx">InjectionPoint</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>

  <span class="nx">inject</span><span class="p">(</span><span class="nx">values</span> <span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_target</span><span class="cp">[</span><span class="nx">this._decoratedPropertyName</span><span class="cp">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_target</span><span class="cp">[</span><span class="nx">this._decoratedPropertyName</span><span class="cp">]</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_target</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Property injection can only use the first value.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_target</span><span class="cp">[</span><span class="nx">this._decoratedPropertyName</span><span class="cp">]</span> <span class="o">=</span> <span class="nx">values</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>As before, the code and unit tests can be found over at <a href="https://github.com/jonnyreeves/ts-prop-injection/tree/02-method-injection">github.com/jonnyreeves/ts-prop-injection</a> - I've also raised a pull request on the repo to highlight the changes: <a href="https://github.com/jonnyreeves/ts-prop-injection/pull/1">github.com/jonnyreeves/ts-prop-injection/pull/1</a>.</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2015/basic-typescript-dependency-injection-with-decorators/#basic-typescript-dependency-injection-with-decorators">Basic Typescript Dependency Injection with Decorators</a></h2>
    <p>
      Posted on Sat 01 August 2015 in <a href="http://jonnyreeves.co.uk/category/typescript.html">TypeScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2015/basic-typescript-dependency-injection-with-decorators/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>Typescript 1.5 <a href="https://github.com/Microsoft/TypeScript/wiki/What's-new-in-TypeScript#decorators">introduced decorators</a> to the language which lets us experiment with <a href="https://en.wikipedia.org/wiki/Metaprogramming">meta-programming</a>. Metadata driven Dependency Injection frameworks allow you to write highly decoupled units which are easy to test and switch out between projects / frameworks.  Let's see how we can use decorators to get some simple property injection working with TypeScript.</p>
<p>Let's start with an example of what we want to achieve:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="n">LoginService</span> {
  <span class="n">userModel</span> : <span class="n">UserModel</span>;
  <span class="n">performLogin</span>() : <span class="nb">void</span> {
    <span class="k">if</span> (!<span class="n">this</span>.<span class="n">userModel</span>.<span class="n">isLoggedIn</span>()) {
      // ... <span class="n">implementation</span> <span class="n">omitted</span>...
    }
  }
</pre></div>


<p>Here our <code>LoginService</code> wants to check if our user is logged in before doing anything; as a result we need to provide a reference to the <code>UserModel</code> before invoking <code>LoginService#performLogin()</code>, we can do this manually:</p>
<div class="highlight"><pre>const myUserModel = new UserModel();
const myLoginService = new LoginService();

// Manually inject the dependency before using the Service.
myLoginService.userModel = myUserModel;
myLoginService.performLogin();
</pre></div>


<p>We can use a decorator to record the fact that <code>LoginService</code> has a dependency on <code>UserModel</code>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="n">LoginService</span> {
  <span class="nv">@inject</span>(<span class="s">&#39;UserModel&#39;</span>)
  <span class="n">userModel</span> : <span class="n">UserModel</span>
</pre></div>


<p>Now we need to implement our <code>@inject</code> decorator, the contract requires us to export a factory function (ie: a function which returns a function) - this factory function will be invoked each time a new instance of the supplied Class is constructed giving us a chance to modify the behavior of the program at run-time.</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">inject</span><span class="p">(</span><span class="nx">injectionKey</span> <span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Our decorator provides a factory function which will be invoked with an</span>
    <span class="c1">// instance of the decorated Class and the name of the decorated property.</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">recordInjection</span><span class="p">(</span><span class="nx">target</span> <span class="o">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">decoratedPropertyName</span> <span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="p">{</span>

        <span class="c1">// Get a reference to the Class of the target object which has been</span>
        <span class="c1">// decorated.</span>
        <span class="kr">const</span> <span class="nx">targetType</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">__inject__</span><span class="o">?:</span> <span class="nb">Object</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">targetType</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;__inject__&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">targetType</span><span class="p">.</span><span class="nx">__inject__</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>

        <span class="c1">// Associate this property with the injectionKey provided in the </span>
        <span class="c1">// decorator call</span>
        <span class="nx">targetType</span><span class="p">.</span><span class="nx">__inject__</span><span class="cp">[</span><span class="nx">decoratedPropertyName</span><span class="cp">]</span> <span class="o">=</span> <span class="nx">injectionKey</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>


<p>Now we need somewhere to record injection mappings so we have values to inject into decorated properties:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="n">Injector</span> <span class="p">{</span>
    <span class="n">private</span> <span class="nl">valuesByInjectionKey</span> <span class="p">:</span> <span class="p">{</span> <span class="p">[</span> <span class="nl">injectionKey</span> <span class="p">:</span> <span class="n">string</span> <span class="p">]</span> <span class="o">:</span> <span class="n">any</span> <span class="p">}</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * Associate an injectionKey with a value so that the supplied value can be </span>
<span class="cm">     * injected into properties of the target Class decorated with the `@inject` </span>
<span class="cm">     * decorator.</span>
<span class="cm">     *</span>
<span class="cm">     * @param {string} injectionKey</span>
<span class="cm">     * @param {*} value</span>
<span class="cm">     */</span>
    <span class="n">mapValue</span><span class="p">(</span><span class="nl">injectionKey</span> <span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="nl">value</span> <span class="p">:</span> <span class="n">any</span><span class="p">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="p">{</span>
        <span class="n">this</span><span class="p">.</span><span class="n">valuesByInjectionKey</span><span class="p">[</span><span class="n">injectionKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Continuing our original example we would map the injectionKey <code>UserModel</code> to the instance of <code>UserModel</code> that we want injected, eg:</p>
<div class="highlight"><pre>const injector = new Injector();
injector.mapValue(&#39;UserModel&#39;, new UserModel());
</pre></div>


<p>Finally we need to introduce a factory function which will instantiate a class but also fulfill injections based on mappings in the Injector - to enable this we add an <code>#instantiate()</code> method to <code>Injector</code>.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="n">Injector</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Create a new instance of the supplied Class fulfilling any property </span>
<span class="cm">     * injections which are present in the injectionRules map.</span>
<span class="cm">     */</span>
    <span class="n">instantiate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">Class</span> <span class="o">:</span> <span class="p">{</span> <span class="n">new</span><span class="p">(...</span><span class="nl">args</span><span class="p">:</span> <span class="n">any</span><span class="p">[])</span> <span class="o">:</span> <span class="n">T</span> <span class="p">})</span> <span class="o">:</span> <span class="n">T</span> <span class="p">{</span>
        <span class="c1">// Start by creating a new instance of the target Class.</span>
        <span class="k">const</span> <span class="nl">instance</span> <span class="p">:</span> <span class="n">any</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">Class</span><span class="p">();</span>

        <span class="c1">// Loop through all properties decorated with `@inject()` in this Class and</span>
        <span class="c1">// try to satisfy them if there is a mapped value.</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">injectionPoint</span> <span class="n">of</span> <span class="n">this</span><span class="p">.</span><span class="n">getInjectionPoints</span><span class="p">(</span><span class="kt">Class</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">const</span> <span class="nl">injectionValue</span> <span class="p">:</span> <span class="n">any</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">valuesByInjectionKey</span><span class="p">[</span><span class="n">injectionPoint</span><span class="p">.</span><span class="n">injectionKey</span><span class="p">];</span>

            <span class="c1">// Perform the injection if we have a value assigned to this injectionKey.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">injectionValue</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">instance</span><span class="p">[</span><span class="n">injectionPoint</span><span class="p">.</span><span class="n">propertyName</span><span class="p">]</span> <span class="o">=</span> <span class="n">injectionValue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">private</span> <span class="n">getInjectionPoints</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">Class</span> <span class="o">:</span> <span class="p">{</span> <span class="n">__inject__</span><span class="o">?:</span> <span class="p">{</span> <span class="p">[</span> <span class="nl">prop</span> <span class="p">:</span> <span class="n">string</span> <span class="p">]</span> <span class="o">:</span> <span class="n">string</span> <span class="p">}</span> <span class="p">})</span> <span class="o">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">InjectionPoint</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">var</span> <span class="nl">result</span> <span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">InjectionPoint</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="c1">// Retrieve the `__inject__` hash created by the @inject decorator from the</span>
        <span class="c1">// target Class.</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">Class</span><span class="p">.</span><span class="n">hasOwnProperty</span><span class="p">(</span><span class="err">&#39;</span><span class="n">__inject__</span><span class="err">&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Object</span><span class="p">.</span><span class="n">keys</span><span class="p">(</span><span class="kt">Class</span><span class="p">.</span><span class="n">__inject__</span><span class="p">)</span>
                <span class="p">.</span><span class="n">map</span><span class="p">((</span><span class="nl">propertyName</span> <span class="p">:</span> <span class="n">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nl">propertyName</span><span class="p">:</span> <span class="n">propertyName</span><span class="p">,</span>
                        <span class="nl">injectionKey</span><span class="p">:</span> <span class="kt">Class</span><span class="p">.</span><span class="n">__inject__</span><span class="p">[</span><span class="n">propertyName</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">interface</span> <span class="n">InjectionPoint</span> <span class="p">{</span>
    <span class="nl">propertyName</span> <span class="p">:</span> <span class="n">string</span><span class="p">;</span>
    <span class="nl">injectionKey</span> <span class="p">:</span> <span class="n">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The <code>Injector#intantiate()</code> method looks for the <code>#__inject__</code> property added to a Class' constructor function by the <code>@inject</code> decorator and then uses the values that hash contains to fulfil the decorated dependencies of the target Class - ie:</p>
<div class="highlight"><pre>const myUserModel = new UserModel();
injector.mapValue(&#39;UserModel&#39;, myUserModel);

// `#userModel` will be injected automatically by by injector
var myLoginService = injector.instantiate(LoginService)
myLoginService.performLogin();
</pre></div>


<p>A complete example with Mocha Tests provided over at <a href="https://github.com/jonnyreeves/ts-prop-injection/tree/01-property-injection">github.com/jonnyreeves/ts-prop-injection</a>.  </p>
<p>Part 2: <a href="/2015/injecting-into-methods-with-typescript-decorators/">Adding support of method injection</a>.</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2015/hello-typescript-and-mocha/#hello-typescript-and-mocha">Hello Typescript and Mocha!</a></h2>
    <p>
      Posted on Mon 27 July 2015 in <a href="http://jonnyreeves.co.uk/category/typescript.html">TypeScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2015/hello-typescript-and-mocha/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>Let's see what we can do with TypeScript then.  First things first we  need to create a local project to hack on:</p>
<div class="highlight"><pre>$ npm init
name: (hello-ts-mocha)
version: (1.0.0)
description: Getting started with TypeScript and mocha
entry point: (index.js)
test command: mocha
git repository:
keywords:
license: (ISC)
</pre></div>


<p>Now let's grab the TypeScript compiler so we can build the project:</p>
<div class="highlight"><pre>npm install typescript --save
</pre></div>


<p>Now let's grab Mocha for our tests</p>
<div class="highlight"><pre>npm install mocha --save-dev
</pre></div>


<h2>Create a Subject to Test</h2>
<p>Time to create our subject that we're going to test, let's do some TDD (:  Create a new file, <code>index.ts</code> in the project root</p>
<div class="highlight"><pre>export default class Calculator {
    add(x : number, y : number) : number {
        return 0;
    }
}
</pre></div>


<p>And now to compile this down to ES5 so we can execute it under node:</p>
<div class="highlight"><pre>./node_modules/typescript/bin/tsc index.ts --module commonjs
</pre></div>


<p>We can simplify the compilation step by adding a prepublish <a href="https://docs.npmjs.com/misc/scripts">npm script</a> to the <code>package.json</code> file:</p>
<div class="highlight"><pre>{
    ...
    &quot;scripts&quot;: {
        &quot;prepublish&quot;: &quot;tsc index.ts --module commonjs &quot;,
        &quot;test&quot;: &quot;mocha&quot;
    }
    ...
}
</pre></div>


<p>We can now compile with <code>npm install</code>.</p>
<h2>Adding a Test</h2>
<p>Let's create our first test; following convention lets create our test-case in <code>test/CalculatorTest</code>.</p>
<p>Before writing the test-case we need to grab the Mocha Type Definitions (requried for the TypeScript compiler (<code>tsc</code>) to work).  Easiest way to get these it to use the DefinitelyTyped TypeScript Definition manager (<code>tsd</code>).</p>
<div class="highlight"><pre>npm install tsd -g
</pre></div>


<p>Once installed we can use it to grab mocha's type definitions:</p>
<div class="highlight"><pre>tsd install mocha --save
</pre></div>


<p>This will add a <code>typings/</code> folder to our project.  Here's what our source tree looks like so far:</p>
<div class="highlight"><pre>hello-ts-mocha
├── index.ts
├── node_modules
│   └── typescript
├── package.json
├── test
│   └── CalculatorTest.js
├── tsd.json
└── typings
    ├── mocha
    └── tsd.d.ts
</pre></div>


<p>Now we can reference the mocha type definition using a <code>/// &lt;reference /&gt;</code> comment:</p>
<div class="highlight"><pre><span class="o">///</span> <span class="o">&lt;</span><span class="n">reference</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;../typings/mocha/mocha.d.ts&quot;</span> <span class="o">/&gt;</span>
<span class="kn">import</span> <span class="nn">Calculator</span> <span class="nn">from</span> <span class="s">&#39;../index&#39;</span><span class="p">;</span>

<span class="n">describe</span><span class="p">(</span><span class="s">&#39;Calculator&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">subject</span> <span class="p">:</span> <span class="n">Calculator</span><span class="p">;</span>

    <span class="n">beforeEach</span><span class="p">(</span><span class="n">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Calculator</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="n">describe</span><span class="p">(</span><span class="s">&#39;#add&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="n">it</span><span class="p">(</span><span class="s">&#39;should add two numbers together&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="n">var</span> <span class="n">result</span> <span class="p">:</span> <span class="n">number</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;Expected 2 + 3 = 5 but was &#39;</span> <span class="o">+</span> <span class="n">result</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>Before we can run the tests we need to compile them, best way to do this is to add a <code>preTest</code> NPM script to invoke the typscript compiler before running mocha. Open up the <code>package.json</code> file again:</p>
<div class="highlight"><pre>{
    ...
    &quot;scripts&quot;: {
        &quot;pretest&quot;: &quot;tsc test/*Test.ts --module commonjs&quot;,
        &quot;test&quot;: &quot;mocha&quot;
    }
}
</pre></div>


<p>We can now run our test-case with <code>npm test</code>:</p>
<div class="highlight"><pre>$ npm test
&gt; ts-mocha@1.0.0 pretest /private/tmp/foo
&gt; tsc test/*Test.ts --module commonjs

&gt; ts-mocha@1.0.0 test /private/tmp/foo
&gt; mocha

  Calculator
    #add
      1) should add two numbers together


  0 passing (19ms)
  1 failing

  1) Calculator #add should add two numbers together:
     Error: Expected 2 + 3 = 5 but was 0
      at Context.&lt;anonymous&gt; (test/CalculatorTest.js:12:23)
</pre></div>


<p>Have fun fixing the test-case :)  Full source over over at <a href="https://github.com/jonnyreeves/hello-ts-mocha">github.com/jonnyreeves/hello-ts-mocha</a></p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2014/simple-javascript-classes-in-commonjs/#simple-javascript-classes-in-commonjs">Simple JavaScript Classes in CommonJS</a></h2>
    <p>
      Posted on Sat 26 July 2014 in <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2014/simple-javascript-classes-in-commonjs/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>Having recently become an advocate of CommonJS modules and Browserify our team was looking for a simple way to define Plain old JavaScript Classes in our modules.  We've settled on the following style, making use of <a href="https://github.com/justmoon/node-extend">extend</a> and <a href="https://github.com/isaacs/inherits">inherits</a>; two tiny, focused CommonJS modules which will add a whopping 2kb to our project when unminified.</p>
<div class="highlight"><pre><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">inherits</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;inherits&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">extend</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;extends&quot;</span><span class="p">);</span>

<span class="c1">// Declare the constructor and member properties.</span>
<span class="kd">function</span> <span class="nx">MyClass</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// Make a call to the Parent Class&#39; constructor. The `_super` </span>
  <span class="c1">// member is provided by the `inherits` call below and is</span>
  <span class="c1">// preferred to calling the `MyParentClass` constructor function</span>
  <span class="c1">// directly should we want to alter the inheritence.</span>
  <span class="nx">MyClass</span><span class="p">.</span><span class="nx">super_</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">foo</span><span class="p">);</span>

  <span class="c1">// Keep things straight forward and performant by simply hinting</span>
  <span class="c1">// at privacy with a leading underscore.</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_bar</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Establish an inheritance relationship with another Class.</span>
<span class="nx">inherits</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">,</span> <span class="nx">MyParentClass</span><span class="p">);</span>

<span class="c1">// Define static members directly on the Constructor function.</span>
<span class="nx">MyClass</span><span class="p">.</span><span class="nx">explode</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;KABOOM!&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Declare instance methods.</span>
<span class="nx">extend</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

  <span class="c1">// Place all methods on the prototype so they&#39;re shared amongst</span>
  <span class="c1">// all instances.  Using `extends` in this fashion ensures that</span>
  <span class="c1">// the `constructor` property remains correctly pointed at the</span>
  <span class="c1">// `MyClass` function so `instanceof` checks work as expected.</span>
  <span class="nx">greet</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">someone</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Make a call to the Parent Class&#39; `greet` method.</span>
    <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">super_</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">greet</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">someone</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">greeting</span> <span class="o">+</span> <span class="s2">&quot;, dude!&quot;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="c1">// Again, just hint at privacy with a leading underscore; doing</span>
  <span class="c1">// so ensures you have easy access to `this` in each method.</span>
  <span class="nx">_throbulate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Implementation omitted for brevity.</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="kr">export</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">;</span>
</pre></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2014/using-browserify-without-a-node_modules-directory/#using-browserify-without-a-node_modules-directory">Using Browserify without a node_modules directory</a></h2>
    <p>
      Posted on Sat 19 July 2014 in <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2014/using-browserify-without-a-node_modules-directory/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>NPM and Bower are pretty awesome; they provides both NodeJS and web developers a way to share CommonJS modules (aka packages) amongst code-bases without relying on copy/pasting concatenated .js files.  Browserify fills in the missing link for deploying an application to the web; it gathers up disparate CommonJS modules which NPM/Bower resolved and bundles them up into a single .js file ready to be dropped into a <code>&lt;script&gt;</code> tag.</p>
<p>When writing CommonJS code, you can import files by two methods, either relativley, (typically used internally inside your app / module), ie:</p>
<div class="highlight"><pre>var MakePizzaCommand = require(&quot;./commands/MakePizzaCommand&quot;);
</pre></div>


<p>Or you can import entire libraries, eg: those which were resolved by Bower / NPM</p>
<div class="highlight"><pre>var reqwest = require(&quot;reqwest&quot;);
</pre></div>


<p>In the first example, Browserify will locate the <code>MakePizzaCommand</code> object by reading the file relative from the host file making the <code>require</code> call; ie:</p>
<div class="highlight"><pre>├── app.js &lt;-- makes the require call
└── commands
    └── MakePizzaCommand.js  &lt;-- gets included
</pre></div>


<p>In the second example, Browserify identifies that you are not referencing a local file (as the <code>require</code> argument does not look like a path), so instead it starts looking up the directory tree for a <code>node_modules</code> folder which contains a subfolder for the module the host file making the require call is trying to import.</p>
<div class="highlight"><pre>pizzajs
├── node_modules &lt;-- 3. found it! now look in each subfolder
│   │                  for a package.json file with the name of
│   │                  the module we are trying to import.
│   └── reqwest
│       └── package.json
│
├── src &lt;-- 2. no `node_modules` dir here either, so look in the
│   │               parent dir (pizzajs)
│   │
│   ├── app.js &lt;-- 1. makes the require call, no `node_modules` dir
│   │               here so look in parent dir (src)
│   └── commands
│       └── MakePizzaCommand.js
└── test
</pre></div>


<p>But what if you don't want to use NPM / Bower to resolve your dependencies?  AFAIK you have two options avaiable to you:</p>
<ol>
<li>
<p>Create a <code>node_modules</code> folder in your project and copy all your CommonJS libraries into it during the build process; note that the <code>node_modules</code> folder must sit either adjacent to your project's sources (<code>src</code>) or in a ancestor folder.</p>
</li>
<li>
<p>Make use of the <a href="http://nodejs.org/api/modules.html"><code>NODE_PATH</code> environment variable</a>, this provides another absolute URL for browserify to use when looking for CommonJS modules.  This allows you to pull off the following folder structure (which may suit none-javascript-based build systems better):</p>
</li>
</ol>
<div class="highlight"><pre>pizzajs
├── lib
│   └── reqwest
│       └── package.json
└── src
    └── app.js
</pre></div>


<p>If you're using Grunt, you can easily set the <code>NODE_PATH</code> environment variable with each build by adding the following to the top of your <code>Gruntfile.js</code>:</p>
<div class="highlight"><pre><span class="c1">// Set NODE_PATH env-var to the cwd.</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="cp">[</span><span class="s2">&quot;NODE_PATH&quot;</span><span class="cp">]</span> <span class="o">=</span> <span class="nx">__dirname</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span> <span class="p">..</span> <span class="p">});</span>
<span class="p">});</span>
</pre></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2013/making-xhr-request-to-https-domains-with-winjs/#making-xhr-request-to-https-domains-with-winjs">Making XHR Request to HTTPS domains with WinJS</a></h2>
    <p>
      Posted on Fri 25 January 2013 in <a href="http://jonnyreeves.co.uk/category/winjs.html">WinJS</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2013/making-xhr-request-to-https-domains-with-winjs/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>I recently came across an interesting caveat when working with WinJS (the JavaScript layer for creating Windows 8 Store applications). If you attempt to make an HTTP POST request to a server over the HTTPS protocol you may run into the following error:</p>
<div class="highlight"><pre><span class="n">XMLHttpRequest</span><span class="o">:</span> <span class="n">Network</span> <span class="n">Error</span> <span class="mh">0x2ef3</span><span class="o">,</span> <span class="n">Could</span> <span class="n">not</span> <span class="n">complete</span> <span class="n">the</span> <span class="n">operation</span> <span class="n">due</span> <span class="n">to</span> <span class="n">error</span> <span class="mi">00002</span><span class="n">ef3</span><span class="o">.</span>
</pre></div>


<p>This error appears to be caused by a security certificate issue; however the solution is pretty straight forward – you just need to make a GET request before attempting subsequent POST request, for example:</p>
<div class="highlight"><pre><span class="c1">// Before making a POST request we first have to issue a GET against the target</span>
<span class="c1">// server to work around Network Error 0x2ef3.  Note you only need to do this</span>
<span class="c1">// ONCE in your app, not every time.</span>
<span class="nx">WinJS</span><span class="p">.</span><span class="nx">xhr</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://my.server/&quot;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// After a single GET request we can now invoke POST requests.</span>
    <span class="nx">WinJS</span><span class="p">.</span><span class="nx">xhr</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://my.server/endpoint&quot;</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">foo</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;HTTPS POST request complete!&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2012/modular-javascript-unit-testing-with-qunit-and-requirejs/#modular-javascript-unit-testing-with-qunit-and-requirejs">Modular Javascript Unit Testing with QUnit and RequireJS</a></h2>
    <p>
      Posted on Tue 14 August 2012 in <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2012/modular-javascript-unit-testing-with-qunit-and-requirejs/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>Modular application development is essential when working on a large project with more than a handful of developers. Breaking your code into separate modules improves code legibility and organization making it easier to locate logic and help create ‘seams’ in your code so you can do your best to adhere to <a href="http://www.codinghorror.com/blog/2007/03/curlys-law-do-one-thing.html">Single Responsibility Principle</a>. This is all well and good for your application code, but what about the Unit Tests which support it – how can we decompose these tests into modules so they’re well organized and easy to find?</p>
<h3>Test Case Structure</h3>
<p>First things first, you need to get your Unit Tests broken up into separate test cases. QUnit provides the QUnit.module method which takes care of this, allowing your to group tests in the QUnit test runner. We can extend this metaphor further by ensuring that each QUnit module resides in its own file, or, in other words – each application module has it’s own QUnit module of tests.</p>
<p>Here’s an example of a simple QUnit Test Case defined as a RequireJS module:</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Import depdendencies (note you can use relative paths here)</span>
    <span class="kd">var</span> <span class="nx">PegiRatings</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./PegiRatings&quot;</span><span class="p">);</span>

    <span class="c1">// Define the QUnit module and lifecycle.</span>
    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;example/model/PegiRatings&quot;</span><span class="p">);</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;isSuitibleFor - younger age supplied, returns false&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">PegiRatings</span><span class="p">.</span><span class="nx">PEGI_18</span><span class="p">.</span><span class="nx">isSuitibleFor</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;isSuitibleFor - same age supplied, returns true&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">PegiRatings</span><span class="p">.</span><span class="nx">PEGI_18</span><span class="p">.</span><span class="nx">isSuitibleFor</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;isSuitibleFor - older age supplied, returns true&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">PegiRatings</span><span class="p">.</span><span class="nx">PEGI_18</span><span class="p">.</span><span class="nx">isSuitibleFor</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>As you can see above, we are able to use <code>require</code> to import other modules from the src folder into the test case (in the above example we are including the PegiRatings object, which just happens to be the module under test). Here’s another example where we pull in not only other modules from the source tree, but also a vendor library (the ever popular, underscore.js):</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Import depdendencies.</span>
    <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;vendor/underscore&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Player</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./Player&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Game</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./Game&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">PegiRatings</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./PegiRatings&quot;</span><span class="p">);</span>

    <span class="c1">// ... rest of test case omitted for brevity</span>

<span class="p">});</span>
</pre></div>


<h3>Configuring QUnit and RequireJS</h3>
<p>Now that we have our unit tests split out into separate modules, we need to configure the QUnit Test Runner so that it will work with RequireJS to resolve the dependencies. The first step is to modify the stock QUnit Test Runner HTML document so RequireJS is loaded along with all our testcases.</p>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Example Test Runner<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;vendor/qunit.css&quot;</span> <span class="nt">/&gt;</span>

        <span class="c">&lt;!-- QUnit includes --&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;vendor/qunit.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

        <span class="c">&lt;!-- Load RequireJS &amp; the testsuite --&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../src/require-config.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../src/vendor/require.js&quot;</span> <span class="na">data-main=</span><span class="s">&quot;testsuite.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;qunit&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>In a typical QUnit Test Runner setup you would include your <code>tests.js</code> file which included all your QUnit tests. Instead we load the project’s <a href="http://requirejs.org/docs/api.html#config">RequireJS configuration file</a> (which is also used by the main project, to avoid duplication of configuration settings between the tests and the build) and then RequireJS itself with a callback to the <code>testsuite.js</code> file.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Defer Qunit so RequireJS can work its magic and resolve all modules.</span>
    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">autostart</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// Configure RequireJS so it resolves relative module paths from the `src`</span>
    <span class="c1">// folder.</span>
    <span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
        <span class="nx">baseUrl</span><span class="o">:</span> <span class="s2">&quot;../src&quot;</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="c1">// A list of all QUnit test Modules.  Make sure you include the `.js` </span>
    <span class="c1">// extension so RequireJS resolves them as relative paths rather than using</span>
    <span class="c1">// the `baseUrl` value supplied above.</span>
    <span class="kd">var</span> <span class="nx">testModules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;example/model/PlayerTests.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;example/model/PegiRatingsTests.js&quot;</span>
    <span class="p">];</span>

    <span class="c1">// Resolve all testModules and then start the Test Runner.</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">testModules</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
<span class="p">}());</span>
</pre></div>


<p>This file configures RequireJS ready for our Unit Test run and also provides a list of all test cases that we wish to execute. Once RequireJS has finished loading all the test cases, it makes a call to <code>QUnit.start</code> which kicks off the Test Runner.</p>
<h3>Example Project Download</h3>
<p>I’ve pushed all the source for this example project to the <a href="https://github.com/jonnyreeves/qunit-require/">qunit-require GitHub Repo</a>. You can <a href="https://github.com/jonnyreeves/qunit-require/zipball/master">download the zipball</a> and run the tests to gain a better understanding of the project structure.</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2012/listening-for-jquery-mobile-slider-events/#listening-for-jquery-mobile-slider-events">Listening for jQuery Mobile Slider Events</a></h2>
    <p>
      Posted on Tue 24 July 2012 in <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2012/listening-for-jquery-mobile-slider-events/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>jQuery Mobile provides a neat little slider control; however, the version 1.1 release doesn’t behave very well and fails to dispatch the expected start and stop events triggered by jQuery UI’s slider control. <a href="https://github.com/jquery/jquery-mobile/issues/1589">This issue (#1589)</a> has been raised on jQuery Mobile’s GitHub Issue Tracker but it looks like it won’t be addressed until jQuery Mobile 1.2</p>
<p>The code below is a patch which you can drop into your application’s startup routine; it adds a couple of event listeners to the DOM which will trigger the start and stop events based on the user’s interaction with the slider’s thumb and track.</p>
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">({</span>
    <span class="s2">&quot;mousedown touchstart&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="s2">&quot;mouseup touchend&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="s2">&quot;.ui-slider&quot;</span><span class="p">);</span>
</pre></div>


<p>In a nutshell, it binds an event listener to the document object which listens for both <code>mousedown</code> and <code>touchstart</code> events triggered from <code>.ui-slider</code> elements. Once triggered the handler function will find the input element which sits alongside the <code>.ui-slider</code> control that was interacted with and trigger the corresponding event. You can consume these events like so:</p>
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#my-slider&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User has started sliding my-slider!&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#my-slider&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User has finished sliding my slider, final value: &quot;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>As always, you can also subscribe to the slider’s change event if you want to listen for the actual slide.</p>
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#my-slider&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Slider is moving, it&#39;s value is now: &quot;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2012/streaming-video-from-azure-blob-storage/#streaming-video-from-azure-blob-storage">Streaming Video from Azure Blob Storage</a></h2>
    <p>
      Posted on Fri 20 July 2012 in <a href="http://jonnyreeves.co.uk/category/azure.html">Azure</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2012/streaming-video-from-azure-blob-storage/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>By default Azure Blob Storage and Video do not mix well; the first hurdle that developers must get over is that the Content Type for the video must be set correctly (for .mp4 videos that’s usually <code>video/mp4</code>).</p>
<p>The next problem that you’ll face is that the video will not seek correctly; trying to jump forward or backwards in the video won’t work.</p>
<p>This is resolved by changing the <code>DefaultServiceVersion</code> to 2011-08-18 which can be achieved via the Azure’s REST API, or the Managed C# Library as laid out at the end of <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/09/15/windows-azure-blobs-improved-http-headers-for-resume-on-download-and-a-change-in-if-match-conditions.aspx">this MSDN blog post</a>.</p>
<div class="highlight"><pre>var account = CloudStorageAccount.Parse(ConnectionString);
var blobClient = account.CreateCloudBlobClient();
blobClient.SetServiceSettings(new ServiceSettings()
    {
        DefaultServiceVersion = &quot;2011-08-18&quot;
    });
</pre></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://jonnyreeves.co.uk/2012/stubbing-javascript-promises-with-sinonjs/#stubbing-javascript-promises-with-sinonjs">Stubbing JavaScript Promises with SinonJS</a></h2>
    <p>
      Posted on Sat 02 June 2012 in <a href="http://jonnyreeves.co.uk/category/javascript.html">JavaScript</a>
      &#8226; <a href="http://jonnyreeves.co.uk/2012/stubbing-javascript-promises-with-sinonjs/#disqus_thread">Leave a comment</a>
    </p>
  </header>
  <div>
      <p>Asynchronous code lies at the heart of front end development; in order to make your application feel responsive you can’t afford to block execution until some external data has been read. <a href="http://wiki.commonjs.org/wiki/Promises/A">Promises</a> are a well understood design pattern to help encapsulate the state of an asynchronous action. A Promise will only ever transfer from a pending state (ie: when the initial request has been made to the server) to a resolved state. The resolved state can be one of either a failure state (ie: the server sends back a 500 error) or a success state (ie: the JSON data you were expecting has come back). Once a promise has transferred to a resolved state it will not change (it becomes immutable). By employing this pattern you can write some very succinct code which is both easy to read and maintain:</p>
<div class="highlight"><pre><span class="nx">service</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;someData&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* process response */</span> <span class="p">});</span>
    <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* handle the error */</span> <span class="p">});</span>
</pre></div>


<p>The code above makes use of Brain Cavalier’s <a href="https://github.com/cujojs/when">when.js</a> Promises implementation. The rest of this post aims to highlight how you can combine when.js with a mocking framework to make unit testing Promises a piece of cake. If you would still like to learn more about using Promises, and how they make writing asynchronous code easier, then I’d suggest reading <a href="http://blog.briancavalier.com/async-programming-part-1-its-messy">his excellent articles on the subject</a>.</p>
<h3>Why mock Promises?</h3>
<p>One of the golden rules of unit testing is that the <a href="http://martinfowler.com/articles/nonDeterminism.html">code under test must be deterministic</a>. Another golden rule is that <a href="http://pragprog.com/magazines/2012-01/unit-tests-are-first">unit tests must be fast to execute</a>. Although Promises make writing asynchronous code easier, they don’t help with the two points above, take the following example:</p>
<div class="highlight"><pre><span class="c1">// Example of a module that abstracts a RESTful web service.</span>
<span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">fetch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Returns a when.js Promise which will resolve when the data</span>
        <span class="c1">// has been fetched.</span>
        <span class="k">return</span> <span class="nx">when</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;http://myservice.com/api?q=&quot;</span> <span class="o">+</span> <span class="nx">query</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// A client object which consumes the Service, this is what we are going to be </span>
<span class="c1">// unit testing.</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// Returns a promise which will yield the number of pages returned</span>
    <span class="c1">// the supplied query.</span>
    <span class="nx">getNumPages</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Create a fresh service instance.</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="nx">createService</span><span class="p">();</span>

        <span class="c1">// Return a promise which will resolve after the following</span>
        <span class="c1">// `then` block has performed.</span>
        <span class="k">return</span> <span class="nx">service</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

                <span class="c1">// Modifies the result of the Service&#39;s Promise,</span>
                <span class="c1">// future success handlers will reicieve the</span>
                <span class="c1">// number of pages instead of the response data.</span>
                <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">).</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Unit testing the above client is pretty easy; a simple test-case could look like this (This example will be based on QUnit):</p>
<div class="highlight"><pre><span class="nx">asyncTest</span><span class="p">(</span><span class="s2">&quot;getNumPages fetches expected number of pages&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 

    <span class="c1">// A special query which we know will return the expected number of pages.</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">getNumPages</span><span class="p">(</span><span class="s2">&quot;testcase-query&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">numPages</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nx">equal</span><span class="p">(</span><span class="nx">numPages</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;5 pages returned&quot;</span><span class="p">);</span>
            <span class="nx">start</span><span class="p">();</span>
        <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>Although the above test case is easy to read, it doesn’t make for a very good unit test for the following reasons:</p>
<ul>
<li>It’s non-deterministic – if the server over at myservice.com is down, or you try and execute these unit tests offline then the test will fail (infact, it will hang the test-runner as it waits for this asyncTest to complete.)</li>
<li>It’s not going to be fast – a connection needs to be established to the server.</li>
<li>It only tests the success state – we need to test what happens if the service is down, but there’s no obvious way to do that (other than to request an invalid query value from the API.</li>
</ul>
<p>This is where a mocking framework comes in – it will help us solve all three of the problems listed above.</p>
<h3>Promises, Lies and stubbing the truth</h3>
<p>A mocking framework allows you to alter the way functions behave during a unit test. Mocking frameworks are especially powerful in dynamic languages, like JavaScript, as they are able to make large changes to your codebase for a given unit test and then restore all those changes immediately after the test completes. This tutorial is going to be looking at <a href="http://sinonjs.org/">SinonJS</a></p>
<p>As mentioned above, Sinon.js is able to completely rewrite a function during a test-case, let’s revisit our service module above:</p>
<div class="highlight"><pre><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Sinon.js stubbing example&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Use sinon.js to redefine the `service.fetch` function.</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">(</span><span class="nx">service</span><span class="p">,</span> <span class="s1">&#39;fetch&#39;</span><span class="p">).</span><span class="nx">returns</span><span class="p">(</span><span class="s2">&quot;Hello!&quot;</span><span class="p">);</span>

    <span class="c1">// Now when we call it, instead of invoking `jQuery.get`, it returns a String.</span>
    <span class="nx">equal</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;testcase-data&quot;</span><span class="p">),</span> <span class="s2">&quot;Hello!&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>The above example isn’t very useful; however, instead of returning a String, we can just as easily return a Promise instance, and that’s when things start getting useful:</p>
<div class="highlight"><pre><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Stubbing the service so it returns an expected response&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 

    <span class="c1">// Stub the service so it returns a resolved promise.  Note that `when(value)`</span>
    <span class="c1">// is a neat short-cut for creating a Deferred and resolving it.</span>
    <span class="kd">var</span> <span class="nx">expectedResponse</span> <span class="o">=</span> <span class="s1">&#39;{ &quot;pages&quot;: [ &quot;page1&quot;, &quot;page2&quot;, &quot;page3&quot; ]}&#39;</span><span class="p">;</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">(</span><span class="nx">service</span><span class="p">,</span> <span class="s1">&#39;fetch&#39;</span><span class="p">).</span><span class="nx">returns</span><span class="p">(</span><span class="nx">when</span><span class="p">(</span><span class="nx">expectedResponse</span><span class="p">));</span>

    <span class="c1">// Call the client...</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">getNumPages</span><span class="p">(</span><span class="s1">&#39;testcase-query&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">numPages</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nx">strictEqual</span><span class="p">(</span><span class="nx">numPages</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;3 pages returned&quot;</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>Note that the above test-case didn’t need to make user of QUnits <code>asyncTest</code> block – that’s because the expectedPromise Promise object has already been resolved – no need to wait for anything to complete asynchronously. Our test is no longer reliant on the server (hence deterministic) and it no longer relies on a service call (and will therefore execute almost instantly). That leaves only one last point from our rules above – how to test the failure path…</p>
<div class="highlight"><pre><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Simulating a service failure&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 

    <span class="c1">// Again, start by stubbing our service&#39;s fetch method.  This time we will</span>
    <span class="c1">// return a rejected Promise with an error.</span>
    <span class="kd">var</span> <span class="nx">expectedError</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Bad Query&quot;</span><span class="p">);</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">(</span><span class="nx">service</span><span class="p">,</span> <span class="s1">&#39;fetch&#39;</span><span class="p">).</span><span class="nx">returns</span><span class="p">(</span><span class="nx">when</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">expectedError</span><span class="p">));</span>

    <span class="c1">// Call the client and expect it to fail</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">getNumPages</span><span class="p">(</span><span class="s1">&#39;testcase-query&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nx">strictEqual</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">expectedError</span><span class="p">,</span> <span class="s2">&quot;Error from API provided to handler&quot;</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>Hopefully this post has been useful in highlight just a couple of the ways in which Promises and a mocking framework can be combined to remove both non-determinism, and slow execution speed from your tests as well as making it easy to test all paths of your code, even if they depend on external data. I’ve created <a href="https://gist.github.com/2858452">a gist which shows a few other techniques</a> which can be employed for unit testing Promises including the use of Sinon’s yieldTo method which makes it easy to resolve, or reject a Promise resolver supplied as an argument.</p>
  </div>
</article>

  <div class="pagination">
    <a class="btn" href="http://jonnyreeves.co.uk/index3.html">
      <i class="fa fa-angle-left"></i> Older Posts
    </a>
    <a class="btn float-right" href="http://jonnyreeves.co.uk/index.html">
      Newer Posts <i class="fa fa-angle-right"></i>
    </a>
  </div>

    <footer>
      <p>&copy; Jonny Reeves </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30309890-1', 'auto');
  ga('send', 'pageview');
</script>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jonny Reeves ",
  "url" : "http://jonnyreeves.co.uk",
  "image": "/images/avatar.jpg",
  "description": ""
}
</script><script type="text/javascript">
    var disqus_shortname = 'jonnyreeves';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>